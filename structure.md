Searched codebase for "#codebase ƒë·ªçc to√†n b·ªô d·ª± √°n v√† t·ªïng h·ª£p c√°c c√¥ng ngh·ªá ƒë√£ s·ª≠ d·ª•ng m√† c√°ch th·ª©c ho·∫°t ƒë·ªông t∆∞∆°ng ·ª©ng chi ti·∫øt ", 21 results

Searched codebase for "project configuration dependencies package.json build.gradle technologies stack", 19 results

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/package.json#1-1), lines 1 to 80

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/android/app/build.gradle.kts)

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/prisma/schema.prisma#1-1), lines 1 to 300

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/main.ts)

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/app.module.ts)

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/chat/chat.gateway.ts#1-1), lines 1 to 150

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/upload/upload.service.ts)

Searched for files matching `**/payment/*.ts`, 3 matches

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/payment/vnpay.service.ts#1-1), lines 1 to 200

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/notifications/notifications.service.ts#1-1), lines 1 to 100

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/auth/auth.service.ts#1-1), lines 1 to 100

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules/ai/ai.service.ts)

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/android/app/src/main/java/com/prompters/shopeeclone/data/repository/AuthRepository.kt)

Searched for files matching `**/di/*.kt`, no matches

Searched for regex `@Module|@Provides|@HiltAndroidApp` (`**/*.kt`), 20 results

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/android/app/src/main/java/com/prompters/shopeeclone/data/api/NetworkModule.kt#1-1), lines 1 to 100

Searched for regex `Socket|io.socket` (`**/*.kt`), 20 results

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/android/app/src/main/java/com/prompters/shopeeclone/data/manager/SocketManager.kt#1-1), lines 1 to 150

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/backend/src/modules)

Read [](file:///c%3A/Users/ADMIN/Desktop/TN/MobileApplicationDevelopment/Prompters-shop-MAD/android/app/src/main/java/com/prompters/shopeeclone/ui/screens)

D·ª±a tr√™n ph√¢n t√≠ch to√†n di·ªán d·ª± √°n, d∆∞·ªõi ƒë√¢y l√† **T·ªîNG H·ª¢P C√îNG NGH·ªÜ V√Ä C√ÅCH TH·ª®C HO·∫†T ƒê·ªòNG** c·ªßa ·ª©ng d·ª•ng Shopee Clone:

---

# üì± T·ªîNG H·ª¢P C√îNG NGH·ªÜ D·ª∞ √ÅN SHOPEE CLONE

## üèóÔ∏è KI·∫æN TR√öC T·ªîNG QUAN

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ANDROID (Kotlin + Compose)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  UI Layer: Jetpack Compose + Material 3                         ‚îÇ
‚îÇ  State Management: ViewModel + StateFlow                        ‚îÇ
‚îÇ  DI: Dagger Hilt                                                ‚îÇ
‚îÇ  Network: Retrofit + OkHttp + Gson                              ‚îÇ
‚îÇ  Realtime: Socket.io Client                                     ‚îÇ
‚îÇ  Image Loading: Coil                                            ‚îÇ
‚îÇ  Local Storage: DataStore Preferences                           ‚îÇ
‚îÇ  Auth: Credential Manager + Google Identity                     ‚îÇ
‚îÇ  Push Notifications: Firebase Cloud Messaging                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ HTTP REST API / WebSocket
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND (NestJS + TypeScript)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Framework: NestJS 11                                           ‚îÇ
‚îÇ  ORM: Prisma 7 (PostgreSQL)                                     ‚îÇ
‚îÇ  Auth: JWT + Passport + bcrypt                                  ‚îÇ
‚îÇ  Realtime: Socket.io (WebSocket Gateway)                        ‚îÇ
‚îÇ  Payment: VNPay Integration                                     ‚îÇ
‚îÇ  AI: Google Gemini API                                          ‚îÇ
‚îÇ  Storage: Supabase Storage                                      ‚îÇ
‚îÇ  Push: Firebase Admin SDK                                       ‚îÇ
‚îÇ  Email: Nodemailer (Gmail SMTP)                                 ‚îÇ
‚îÇ  API Docs: Swagger/OpenAPI                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DATABASE & SERVICES                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Database: PostgreSQL (Supabase)                                ‚îÇ
‚îÇ  Storage: Supabase Storage (2 buckets)                          ‚îÇ
‚îÇ  Auth Provider: Supabase Auth (Google OAuth)                    ‚îÇ
‚îÇ  Push Service: Firebase Cloud Messaging                         ‚îÇ
‚îÇ  Payment Gateway: VNPay Sandbox                                 ‚îÇ
‚îÇ  AI Service: Google Gemini 3 Flash                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì± ANDROID - FRONTEND

### 1. **Jetpack Compose + Material 3**

- **C√¥ng ngh·ªá**: Declarative UI framework
- **C√°ch ho·∫°t ƒë·ªông**:
  - UI ƒë∆∞·ª£c x√¢y d·ª±ng b·∫±ng `@Composable` functions
  - State-driven rendering v·ªõi `remember` v√† `mutableStateOf`
  - Navigation qua `NavHostController` v·ªõi `composable()` routes
  - Material 3 Design System cho consistent UI/UX

```kotlin
@Composable
fun ProductCard(product: Product, onAddToCart: (String) -> Unit) {
    Card(modifier = Modifier.clickable { onAddToCart(product.id) }) {
        AsyncImage(model = product.imageUrl, ...)
        Text(text = product.name)
    }
}
```

### 2. **MVVM Architecture + Hilt DI**

- **C√¥ng ngh·ªá**: ViewModel + StateFlow + Dagger Hilt
- **C√°ch ho·∫°t ƒë·ªông**:
  - **ViewModel**: Qu·∫£n l√Ω UI state, g·ªçi Repository
  - **StateFlow**: Reactive state container, UI observe ƒë·ªÉ update
  - **Hilt**: Dependency Injection t·ª± ƒë·ªông v·ªõi `@Inject`, `@HiltViewModel`
  - Lifecycle-aware: ViewModel survive configuration changes

```kotlin
@HiltViewModel
class ProductViewModel @Inject constructor(
    private val repository: ProductRepository
) : ViewModel() {
    private val _state = MutableStateFlow<ProductState>(ProductState.Loading)
    val state: StateFlow<ProductState> = _state.asStateFlow()

    fun loadProducts() {
        viewModelScope.launch {
            repository.getProducts().fold(
                onSuccess = { _state.value = ProductState.Success(it) },
                onFailure = { _state.value = ProductState.Error(it.message) }
            )
        }
    }
}
```

### 3. **Retrofit + OkHttp**

- **C√¥ng ngh·ªá**: HTTP client for REST API
- **C√°ch ho·∫°t ƒë·ªông**:
  - `Retrofit`: Convert HTTP API th√†nh Kotlin interface
  - `OkHttpClient`: HTTP client v·ªõi interceptors
  - `AuthInterceptor`: T·ª± ƒë·ªông inject JWT token v√†o header
  - `GsonConverterFactory`: JSON ‚Üî Kotlin object serialization

```kotlin
interface ProductApiService {
    @GET("products")
    suspend fun getProducts(
        @Query("page") page: Int,
        @Query("limit") limit: Int
    ): Response<ProductListResponse>
}

// Interceptor t·ª± ƒë·ªông th√™m token
class AuthInterceptor : Interceptor {
    override fun intercept(chain: Chain): Response {
        val request = chain.request().newBuilder()
            .addHeader("Authorization", "Bearer $token")
            .build()
        return chain.proceed(request)
    }
}
```

### 4. **Socket.io Client**

- **C√¥ng ngh·ªá**: Realtime communication
- **C√°ch ho·∫°t ƒë·ªông**:
  - Connect v·ªõi JWT token qua query params
  - Join/Leave conversation rooms
  - Listen events: `new_message`, `order_status_updated`, `new_order`
  - Broadcast typing indicators
  - Auto-reconnect khi m·∫•t k·∫øt n·ªëi

```kotlin
class SocketManager {
    fun connect(token: String) {
        socket = IO.socket("http://10.0.2.2:3000/chat", IO.Options().apply {
            query = "token=$token"
        })
        socket?.on("new_message") { args -> /* handle message */ }
        socket?.connect()
    }

    fun joinConversation(conversationId: String) {
        socket?.emit("join_conversation", JSONObject().put("conversationId", conversationId))
    }
}
```

### 5. **Firebase Cloud Messaging**

- **C√¥ng ngh·ªá**: Push notifications
- **C√°ch ho·∫°t ƒë·ªông**:
  - ƒêƒÉng k√Ω FCM token khi login th√†nh c√¥ng
  - G·ª≠i token l√™n backend ƒë·ªÉ l∆∞u tr·ªØ
  - Receive notifications qua `FirebaseMessagingService`
  - Handle notification click ‚Üí navigate to relevant screen

### 6. **Coil**

- **C√¥ng ngh·ªá**: Image loading library
- **C√°ch ho·∫°t ƒë·ªông**:
  - `AsyncImage` composable load ·∫£nh t·ª´ URL
  - Auto caching (memory + disk)
  - Placeholder v√† error handling
  - Support WebP, GIF, SVG

### 7. **DataStore Preferences**

- **C√¥ng ngh·ªá**: Local storage for key-value data
- **C√°ch ho·∫°t ƒë·ªông**:
  - Thay th·∫ø SharedPreferences
  - Coroutine-based, type-safe
  - L∆∞u: JWT token, user info, settings

---

## ‚öôÔ∏è BACKEND - NESTJS

### 1. **NestJS Framework**

- **C√¥ng ngh·ªá**: Progressive Node.js framework
- **C√°ch ho·∫°t ƒë·ªông**:
  - **Modules**: T·ªï ch·ª©c code theo feature (AuthModule, ProductsModule...)
  - **Controllers**: Handle HTTP requests, route mapping
  - **Services**: Business logic
  - **Guards**: Authentication/Authorization
  - **Pipes**: Validation (class-validator)
  - **Interceptors**: Logging, transformation

```typescript
@Module({
  imports: [DatabaseModule, JwtModule],
  controllers: [AuthController],
  providers: [AuthService],
})
export class AuthModule {}

@Controller("auth")
export class AuthController {
  @Post("login")
  async login(@Body() dto: LoginDto) {
    return this.authService.login(dto);
  }
}
```

### 2. **Prisma ORM**

- **C√¥ng ngh·ªá**: Next-generation ORM for TypeScript
- **C√°ch ho·∫°t ƒë·ªông**:
  - Schema-first: ƒê·ªãnh nghƒ©a models trong schema.prisma
  - Auto-generate TypeScript types
  - Type-safe queries
  - Migrations: `prisma migrate dev`
  - Introspection: Sync v·ªõi database hi·ªán c√≥

```prisma
model products {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  price       Decimal   @db.Decimal(12, 2)
  shop        shops     @relation(fields: [shop_id], references: [id])
  reviews     reviews[]
}
```

### 3. **JWT Authentication + Passport**

- **C√¥ng ngh·ªá**: Token-based authentication
- **C√°ch ho·∫°t ƒë·ªông**:
  - Login ‚Üí Generate Access Token (7 days) + Refresh Token
  - Client g·ª≠i token trong `Authorization: Bearer <token>`
  - `JwtAuthGuard` verify token m·ªói request
  - `JwtStrategy` extract user info t·ª´ token payload

```typescript
@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
    async validate(payload: JwtPayload) {
        return { userId: payload.userId, email: payload.email, role: payload.role };
    }
}

@UseGuards(JwtAuthGuard)
@Get('profile')
getProfile(@Request() req) {
    return req.user;
}
```

### 4. **Socket.io Gateway (WebSocket)**

- **C√¥ng ngh·ªá**: Realtime bidirectional communication
- **C√°ch ho·∫°t ƒë·ªông**:
  - `@WebSocketGateway`: ƒê·ªãnh nghƒ©a WebSocket server
  - `@SubscribeMessage`: Handle events t·ª´ client
  - Room-based: Clients join rooms (conversations)
  - Broadcast: Emit events to specific rooms/users
  - JWT auth qua query params

```typescript
@WebSocketGateway({ namespace: "/chat", cors: { origin: "*" } })
export class ChatGateway {
  @SubscribeMessage("join_conversation")
  handleJoin(
    @ConnectedSocket() client: Socket,
    @MessageBody() data: { conversationId: string },
  ) {
    client.join(`conversation:${data.conversationId}`);
  }

  emitNewMessage(conversationId: string, message: any) {
    this.server
      .to(`conversation:${conversationId}`)
      .emit("new_message", message);
  }
}
```

### 5. **VNPay Integration**

- **C√¥ng ngh·ªá**: Vietnam payment gateway
- **C√°ch ho·∫°t ƒë·ªông**:
  - T·∫°o payment URL v·ªõi hash signature (HMAC-SHA512)
  - Redirect user ƒë·∫øn VNPay checkout page
  - VNPay callback sau khi thanh to√°n
  - Verify callback signature
  - Update order payment status

```typescript
async createPaymentUrl(orderId: string, amount: number, ...): Promise<string> {
    const vnpParams = {
        vnp_TmnCode: this.vnpTmnCode,
        vnp_Amount: amount * 100,
        vnp_CreateDate: this.formatDate(new Date()),
        vnp_TxnRef: orderId,
        // ... more params
    };
    const signData = this.sortAndEncode(vnpParams);
    const secureHash = crypto.createHmac('sha512', this.vnpHashSecret)
        .update(signData).digest('hex');
    return `${this.vnpUrl}?${signData}&vnp_SecureHash=${secureHash}`;
}
```

### 6. **Supabase Storage**

- **C√¥ng ngh·ªá**: Cloud file storage
- **C√°ch ho·∫°t ƒë·ªông**:
  - 2 buckets: `product-images`, `avatars`
  - Upload via Supabase JS client
  - Generate public URL sau upload
  - Support upsert (replace existing files)

```typescript
async uploadProductImage(file: Express.Multer.File, userId: string): Promise<string> {
    const { data, error } = await this.supabase.storage
        .from('product-images')
        .upload(fileName, file.buffer, { contentType: file.mimetype });

    const { data: { publicUrl } } = this.supabase.storage
        .from('product-images')
        .getPublicUrl(data.path);

    return publicUrl;
}
```

### 7. **Firebase Admin SDK (FCM)**

- **C√¥ng ngh·ªá**: Server-side push notifications
- **C√°ch ho·∫°t ƒë·ªông**:
  - Store FCM tokens per user (support multiple devices)
  - Send notification v·ªõi title, body, data payload
  - Batch send cho nhi·ªÅu users
  - Clean up invalid tokens

```typescript
async sendPushNotification(userId: string, notification: Notification) {
    const tokens = await this.db.fcm_tokens.findMany({ where: { user_id: userId } });

    await admin.messaging().sendEachForMulticast({
        tokens: tokens.map(t => t.token),
        notification: { title, body },
        data: { orderId, type }
    });
}
```

### 8. **Google Gemini AI**

- **C√¥ng ngh·ªá**: Generative AI for product descriptions
- **C√°ch ho·∫°t ƒë·ªông**:
  - Seller nh·∫≠p t√™n s·∫£n ph·∫©m
  - Call Gemini API v·ªõi prompt template
  - AI generate m√¥ t·∫£ h·∫•p d·∫´n v·ªõi emoji
  - Auto-fill v√†o form t·∫°o s·∫£n ph·∫©m

```typescript
async generateProductDescription(productName: string) {
    const prompt = `Vi·∫øt m√¥ t·∫£ s·∫£n ph·∫©m h·∫•p d·∫´n cho: "${productName}"...`;
    const result = await this.model.generateContent(prompt);
    return { description: result.response.text() };
}
```

### 9. **Nodemailer (Email)**

- **C√¥ng ngh·ªá**: SMTP email sending
- **C√°ch ho·∫°t ƒë·ªông**:
  - Forgot password ‚Üí Generate reset token
  - Send email v·ªõi reset link
  - User click link ‚Üí Redirect to reset password page

---

## üóÑÔ∏è DATABASE SCHEMA

### Core Entities:

| Entity          | M√¥ t·∫£                             |
| --------------- | --------------------------------- |
| `users`         | Buyer/Seller/Admin v·ªõi FCM tokens |
| `shops`         | Seller's shop v·ªõi wallet          |
| `products`      | S·∫£n ph·∫©m v·ªõi categories, reviews  |
| `orders`        | ƒê∆°n h√†ng v·ªõi order_details        |
| `cart_items`    | Gi·ªè h√†ng                          |
| `addresses`     | ƒê·ªãa ch·ªâ giao h√†ng                 |
| `conversations` | Chat threads                      |
| `messages`      | Chat messages                     |
| `vouchers`      | M√£ gi·∫£m gi√° (platform/shop)       |
| `wallet`        | V√≠ seller                         |
| `transactions`  | Giao d·ªãch v√≠                      |

---

## üîÑ LU·ªíNG HO·∫†T ƒê·ªòNG CH√çNH

### 1. **Authentication Flow**

```
[Android] ‚Üí Login ‚Üí [Backend] ‚Üí Verify credentials ‚Üí Generate JWT ‚Üí Return tokens
[Android] ‚Üí Store token in DataStore ‚Üí Inject to all API requests
```

### 2. **Order Flow**

```
[Buyer] Add to Cart ‚Üí Checkout ‚Üí Create Order
    ‚Üì
[Backend] Create order ‚Üí Deduct stock ‚Üí Notify seller (FCM + Socket)
    ‚Üì
[Seller] Confirm ‚Üí Ship ‚Üí [Buyer] Receive ‚Üí Complete
    ‚Üì
[Backend] Release payment to seller wallet (after platform fee)
```

### 3. **Realtime Chat Flow**

```
[User A] Connect Socket ‚Üí Join conversation room
[User B] Connect Socket ‚Üí Join same room
    ‚Üì
[User A] Send message ‚Üí [Backend] Save to DB ‚Üí Emit to room
    ‚Üì
[User B] Receive 'new_message' event ‚Üí Update UI instantly
```

### 4. **Payment Flow (VNPay)**

```
[Buyer] Select VNPay ‚Üí [Backend] Generate payment URL
    ‚Üì
[WebView] Open VNPay page ‚Üí User pays
    ‚Üì
[VNPay] Callback to backend ‚Üí Verify signature ‚Üí Update order status
    ‚Üì
[Android] Deep link back to app ‚Üí Show result screen
```

---

## üìä MODULES OVERVIEW

| Module            | Android Screens                    | Backend API                              |
| ----------------- | ---------------------------------- | ---------------------------------------- |
| **Auth**          | Login, Register, ForgotPassword    | `/auth/*`                                |
| **Home**          | HomeScreen, Categories             | `/products`, `/categories`               |
| **Product**       | ProductDetail, Reviews             | `/products/:id`, `/products/:id/reviews` |
| **Cart**          | CartScreen                         | `/cart/*`                                |
| **Checkout**      | CheckoutScreen, AddressSelection   | `/orders`, `/addresses/*`                |
| **Orders**        | OrdersList, OrderDetails           | `/orders/*`                              |
| **Chat**          | ChatList, ChatDetail               | `/chat/*` + WebSocket                    |
| **Seller**        | Dashboard, Products, Orders        | `/seller/*`                              |
| **Admin**         | Dashboard, Shops, Users, Approvals | `/admin/*`                               |
| **Wallet**        | SellerFinance, UserWallet          | `/wallet/*`                              |
| **Vouchers**      | VoucherList, Apply                 | `/vouchers/*`                            |
| **Notifications** | NotificationsList                  | `/notifications/*`                       |

---

ƒê√¢y l√† ki·∫øn tr√∫c ƒë·∫ßy ƒë·ªß c·ªßa ·ª©ng d·ª•ng Shopee Clone v·ªõi c√¥ng ngh·ªá hi·ªán ƒë·∫°i v√† scalable! üöÄ
